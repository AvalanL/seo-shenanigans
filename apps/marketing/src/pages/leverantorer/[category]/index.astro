---
import BaseLayout from "~/layouts/BaseLayout.astro";
import DirectoryCard from "~/components/directory/DirectoryCard.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const suppliers = await getCollection("suppliers");
  const categories = new Set(suppliers.map((entry) => entry.data.category ?? "ovrigt"));
  return Array.from(categories).map((category) => ({ params: { category } }));
}

const category = Astro.params.category;
const entries = await getCollection("suppliers", ({ data }) => (data.category ?? "ovrigt") === category);

const supplierCards = entries.map((entry) => ({
  entry,
  slug: entry.slug.split("/").pop() ?? entry.slug
}));

if (!entries.length) {
  throw new Error(`Hittade inga leverantörer för kategorin ${category}`);
}

const title = `Bröllops${category} i Sverige`;
const description = `Filtrera och hitta ${category} för ert bröllop.`;
---
<BaseLayout title={title} description={description}>
  <section class="intro">
    <p class="breadcrumbs"><a href="/leverantorer">← Alla kategorier</a></p>
    <h1>{title}</h1>
    <p>
      Utforska våra kuraterade leverantörer nedan. Klicka för detaljer och kontakta dem direkt via webb eller e-post.
    </p>
  </section>

  <section class="grid" data-directory-grid>
    {supplierCards.map(({ entry, slug }) => (
      <DirectoryCard
        title={entry.data.title}
        summary={entry.data.summary}
        city={entry.data.city}
        startPrice={entry.data.startPrice}
        image={entry.data.image}
        href={`/leverantorer/${category}/${slug}`}
        categoryLabel={entry.data.serviceArea}
      />
    ))}
  </section>
</BaseLayout>


<style>
  .intro {
    display: grid;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .grid {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }
</style>
