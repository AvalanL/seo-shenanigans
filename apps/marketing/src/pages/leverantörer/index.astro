---
import BaseLayout from "~/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const suppliers = await getCollection("suppliers");
const categories = Array.from(
  suppliers.reduce((map, item) => {
    const category = (item.data.category ?? "ovrigt").toString().replace(/"/g, "");
    if (!map.has(category)) {
      map.set(category, []);
    }
    map.get(category)?.push(item);
    return map;
  }, new Map())
);

const categoryMetadata: Record<string, { label: string; image: string }> = {
  bartender: {
    label: "Bartender",
    image: "/images/suppliers/bartender-00.png",
  },
  catering: {
    label: "Catering",
    image: "/images/suppliers/catering-00.png",
  },
  festfixare: {
    label: "Festfixare",
    image: "/images/suppliers/festfixare-00.png",
  },
  florist: {
    label: "Florist",
    image: "/images/suppliers/florist-00.png",
  },
  fotobas: {
    label: "Fotobås",
    image: "/images/suppliers/fotobas-00.png",
  },
  fotograf: {
    label: "Fotograf",
    image: "/images/suppliers/fotograf-00.png",
  },
  "har-och-smink": {
    label: "Hår & smink",
    image: "/images/suppliers/har-och-smink-00.png",
  },
  klanningar: {
    label: "Klänningar",
    image: "/images/suppliers/klanningar-00.png",
  },
  konfetti: {
    label: "Konfetti",
    image: "/images/suppliers/konfetti-00.png",
  },
  koordinator: {
    label: "Koordinator",
    image: "/images/suppliers/koordinator-00.png",
  },
  musik: {
    label: "Musik",
    image: "/images/suppliers/musik-00.png",
  },
  skyltar: {
    label: "Skyltar",
    image: "/images/suppliers/skyltar-00.png",
  },
  smycken: {
    label: "Smycken",
    image: "/images/suppliers/smycken-00.png",
  },
};
---
<BaseLayout title="Bröllopsleverantörer" description="Hitta fotografer, florister, koordinatorer och andra leverantörer för ert bröllop i Sverige.">
  <section class="intro">
    <h1>Bröllopsleverantörer i Sverige</h1>
    <p>
      Utforska våra kuraterade listor per kategori. Klicka in för att filtrera på stad, pris och tjänster. Vi lägger till nya leverantörer varje vecka – vill du synas? <a href="/kontakt">Kontakta oss</a>.
    </p>
  </section>

  <section class="category-grid">
    {categories.map(([category, items]) => {
      const meta = categoryMetadata[category];
      const label = meta?.label ?? `${category.charAt(0).toUpperCase()}${category.slice(1)}`;
      return (
        <a href={`/leverantörer/${category}`} class="category-card">
          {meta?.image && (
            <div class="category-card__image">
              <img
                src={meta.image}
                alt={`Illustration för ${label.toLowerCase()}`}
                loading="lazy"
                decoding="async"
              />
            </div>
          )}
          <div class="category-card__content">
            <h2>{label}</h2>
            <p>{items.length} listade leverantörer</p>
          </div>
        </a>
      );
    })}
  </section>
</BaseLayout>

<style>
  .category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.5rem;
  }

  .category-card {
    display: grid;
    gap: 1.25rem;
    border: 1px solid rgba(0, 0, 0, 0.12);
    border-radius: 1.5rem;
    padding: 1.25rem 1.25rem 1.75rem;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.96), rgba(255, 255, 255, 0.82));
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .category-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 18px 32px rgba(31, 28, 20, 0.08);
  }

  .category-card__image {
    border-radius: 1rem;
    overflow: hidden;
    aspect-ratio: 4 / 3;
    background: radial-gradient(circle at top, rgba(255, 255, 255, 0.85), rgba(229, 226, 220, 0.35));
  }

  .category-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .category-card__content {
    display: grid;
    gap: 0.4rem;
  }

  .category-card__content h2 {
    margin: 0;
    font-size: 1.2rem;
  }

  .category-card__content p {
    margin: 0;
    color: rgba(31, 28, 20, 0.7);
  }
</style>
